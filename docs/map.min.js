var completedEvents=[];var mymap;var markerGroup;var $geo;var options;$(document).ready(function(){initOptions();initMap();initBurger();centerOnUK();initAndLoad()});function initOptions(){options=JSON.parse(Cookies.get("options")||"{}")}function initBurger(){var a={navToggle:document.querySelector(".nav-toggle"),nav:document.querySelector(".nav"),doToggle:function(b){b.preventDefault();this.navToggle.classList.toggle("expanded");this.nav.classList.toggle("expanded")}};a.navToggle.addEventListener("click",function(c){a.doToggle(c)})}function initMap(){mymap=L.map("mapid",{zoomControl:false,maxBounds:new L.LatLngBounds(new L.LatLng(-90,-180),new L.LatLng(90,180)),minZoom:2});L.control.zoom({position:"topright"}).addTo(mymap);markerGroup=L.layerGroup().addTo(mymap);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(mymap)}function centerOnUK(){mymap.fitBounds([[49.095026,-7.742293],[60.258081000000004,1.847338]])}function displayEvents(d){markerGroup.clearLayers();var e=longitudeMax=latitudeMin=latitudeMax=undefined;var f=0;$geo.find("e").each(function(){var g=$(this);var h=g.attr("m");var i=g.attr("r");if(i!=""){var j=$geo.find("r[id="+i+"]").closest("r[u!='']").attr("u")}var k=$("[data-region-id-"+i+"]");var l=k.prop("checked")&&completedEvents.indexOf(h)==-1;var m=false;if(l){m=true;for(var n=0;n<d.length;n++){if(m){var o=d[n](g);m=m&&o}}}if(m){var p=g.attr("n");var q=parseFloat(g.attr("lo"));var r=parseFloat(g.attr("la"));if(!isNaN(q)&&!isNaN(r)){if(q<e||typeof e=="undefined"){e=q}if(r<latitudeMin||typeof latitudeMin=="undefined"){latitudeMin=r}if(q>longitudeMax||typeof longitudeMax=="undefined"){longitudeMax=q}if(r>latitudeMax||typeof latitudeMax=="undefined"){latitudeMax=r}var s=L.marker([r,q]);if(typeof j!==undefined){var t="<strong>"+h+'</strong><br /><a target="_blank" href="'+j+"/"+p+'">Course page</a><br /><a target="_blank" href="https://www.google.com/maps/dir/?api=1&destination='+r+","+q+'">Directions</a>';if(options.vegan){t+='<br /><a target="_blank" href="https://www.happycow.net/searchmap?lat='+r+"&lng="+q+'&vegan=true">Local vegan food</a>'}s.bindPopup(t)}else{s.bindPopup(h)}s.addTo(markerGroup);f++}}});if(f>0){latitudeMin=latitudeMin-.1;e=e-.1;latitudeMax=latitudeMax+.1;longitudeMax=longitudeMax+.1;mymap.fitBounds([[latitudeMin,e],[latitudeMax,longitudeMax]])}}$(window).bind("hashchange",function(u){load()});function load(){$(document).ready(function(){var v=decodeURIComponent(window.location.hash);var w=[];var x=v.split("#").filter(function(y){return y});x.forEach(function(z){if(z.startsWith("startsWith-")){var A=z.substring(11);w.push(function(G){var H=G.attr("m");return H.toLowerCase().startsWith(A.toLowerCase())})}else if(z.startsWith("contains-")){var B=z.substring(9);w.push(function(I){var J=I.attr("m");return J.toLowerCase().indexOf(B.toLowerCase())>-1})}else if(z.startsWith("matches-")){var C=z.substring(8);var D=new RegExp(C,"i");w.push(function(K){var M=K.attr("m");return D.test(M.toLowerCase())})}else if(z.startsWith("region-")){var E=z.substring(7);var F=$geo.find("r[n='"+E+"']").attr("id");w.push(function(N){return F===N.attr("r")})}else if(z==="none"){w.push(function(){return false})}else if(z==="all"){w.push(function(){return true})}});if(x.length==0){w.push(function(){return false})}displayEvents(w)})}function init(){$.ajax({url:"geo.xml",async:false}).done(function(O){$geo=$(O);var P=$('<div class="countries"><h4>Countries</h4></div>');$(".nav .controls").append(P);$geo.find("r[id=1] > r").each(function(){var Q=$(this);var R=Q.attr("id");var S=Q.attr("n");var T=$("<input type='checkbox' />");if(S=="UK"){T.attr("checked","")}T.attr("data-region-id-"+R,"");$geo.find("r[id="+R+"] r").each(function(){$region=$(this);T.attr("data-region-id-"+$region.attr("id"),"")});P.append(T).append($("<span />").text(S)).append($("<br />"));T.change(function(){load()})})});$("#letter-prefix").keypress(function(U){if(U.which==13){var V=$("#letter-prefix").val();var V=Array.from(new Set(V.toLowerCase().replace(/[^a-z]/gi,"").split(""))).join("");window.location.hash="#matches-^["+V+"]"}});$("#search").keypress(function(W){if(W.which==13){var X=$("#search").val();window.location.hash="#matches-.*"+X+".*"}})}function initAndLoad(){init();load()}
